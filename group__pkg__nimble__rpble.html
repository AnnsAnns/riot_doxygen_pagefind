<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RIOT OS: RPL-over-BLE for NimBLE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<!-- <script type="text/javascript" src="jquery.js"></script> -->
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<!-- <link href="/pagefind/pagefind-ui.css" rel="stylesheet"> -->
<script src="/pagefind/pagefind-ui.js"></script>
<script>
  // Check whether the PagefindUI class is available
  if (typeof PagefindUI === 'undefined') {
    console.error('PagefindUI class is not available | Dev Build');
  } else {
    // // Remove the "searchstub" element and initialize the PagefindUI class
    // document.getElementById("#searchstub").remove();
    // Initialize the PagefindUI class with the element id "search"
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
  }
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="global.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <script>
    // Print the data within the NAVTREE variable from the navtreedata.js file
    var navtree = NAVTREE;
    console.log(navtree);
  </script>
<div class="flex flex-row gap-4 w-screen font-sans text-lg max-h-screen overscroll-contain justify-items-stretch bg-neutral-900">
  <!--Sidebar-->
  <div data-pagefind-ignore="all" class="w-1/3 max-w-md flex-auto h-screen bg-neutral-800 ring-2 ring-neutral-700 shadow-neutral-800 shadow-2xl rounded-xl p-3 ml-1 my-2 mr-3 flex flex-col justify-around">
    <div id="top" class="justify-self-center content-center items-center place-content-center">
      <img alt="Logo" src="riot-logo.svg"/>
      <div id="projectbrief">
        The friendly Operating System for the Internet of Things
      </div>
    </div>
    <div id="search" class="place-content-center" class="overflow-y-scroll max-h-64 bg-slate-400 ring-2 ring-white text-white" >
      <h1>Searchbar via Pagefind</h1>
      <!-- <div id="searchstub" class="flex items-center border border-gray-300 rounded-lg p-2 shadow-sm">
        <input type="text" placeholder="Search is only available in Production Build ..." class="flex-grow p-2 outline-none">
      </div> -->
    </div>
    <div id="navtree">
      <script>
        // The navtree variable is always a pair of two elements (key, value)
        // The key is the name we should display and the value is the link to the page
        // Generate the navtree from the navtreedata.js file and put it under the navtree div
        var navtree = NAVTREE[0][2];
        var navtreeHTML = "<h1>Navigation based on Doxygen</h1> <ul>";
        for (var i = 0; i < navtree.length; i++) {
          navtreeHTML += "<li><a href='" + navtree[i][1] + "'>" + navtree[i][0] + "</a></li>";
          if (i == 5) {
            navtreeHTML += '<li><h3 class="ring-2 ring-white"> Random Insert for Demonstration </h3></li>';
          }
        }
        navtreeHTML += "</ul>";
        document.getElementById("navtree").innerHTML = navtreeHTML;
      </script>
    </div>
    <ul>
      <li class="footer">
        Generated on Tue Sep 24 2024 11:16:27 by 
          <a href="http://www.doxygen.org/index.html">
            Doxygen
          </a> 
        1.12.0
      </li>
    </ul>
  </div>
  <!--Main Content-->
  <div class="hidden">
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__pkg__nimble__rpble.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">RPL-over-BLE for NimBLE<div class="ingroups"><a class="el" href="group__pkg.html">Packages</a> &#124; <a class="el" href="group__net.html">Networking</a> &raquo; <a class="el" href="group__ble.html">Bluetooth Low Energy (BLE)</a> &raquo; <a class="el" href="group__pkg__nimble.html">NimBLE</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>RPL-over-BLE for Nimble implementation  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>RPL-over-BLE for Nimble implementation </p>
<h1><a class="anchor" id="autotoc_md1858"></a>
About</h1>
<p>This module implements a BLE connection manager the manages BLE connections for (multi-hop) IP over BLE networks based on meta data provided by RPL.</p>
<h1><a class="anchor" id="autotoc_md1859"></a>
Concept</h1>
<p>In their initial state, after power up or reboot, nodes start to scan for BLE advertisements containing a specific advertising data (AD) field which holds information about RPL DODAGs. For a configured amount of time, the node ranks all senders of the received advertising packets based on a given metric. After this time, the node selects the best fitting parent based on this ranking and tries to connect to that peer.</p>
<p>After a node has successfully opened a connection to its parent node, the node starts to advertise its own RPL context data to accept connections from potential child nodes.</p>
<p>This approach leads to a BLE network topology that is equal to the IP routing topology created by RPL on top.</p>
<h2><a class="anchor" id="autotoc_md1860"></a>
Advertising data structure</h2>
<p>To include RPL context information into (legacy) BLE advertisements, it must be encoded into the BLE advertising data format. This implementation uses a custom sub-format that is included into the 16-bit UUID Service Data (type: 0x16) field (Supplement to Bluetooth Core Specification CSSv8, 1.11). The 16-bit UUID in this field is set to the IPSS service ID (0x1820).</p>
<p>The following sub-format is used to encode the RPL context data: </p><div class="fragment"><div class="line"><span class="keywordtype">byte</span>     1: instance ID (1b)</div>
<div class="line"><span class="keywordtype">byte</span>  2-17: DODAG ID (16b)</div>
<div class="line"><span class="keywordtype">byte</span>    18: DODAG version (1b)</div>
<div class="line"><span class="keywordtype">byte</span>    19: RPL role (1b)</div>
<div class="line"><span class="keywordtype">byte</span> 20-21: rank (2b)</div>
<div class="line"><span class="keywordtype">byte</span>    22: number of <a class="code hl_function" href="group__oneway__malloc.html#gafbedc913aa4651b3c3b4b3aecd9b4711">free</a> BLE connection slots (1b)</div>
<div class="ttc" id="agroup__oneway__malloc_html_gafbedc913aa4651b3c3b4b3aecd9b4711"><div class="ttname"><a href="group__oneway__malloc.html#gafbedc913aa4651b3c3b4b3aecd9b4711">free</a></div><div class="ttdeci">void free(void *ptr)</div><div class="ttdoc">This is a no-op.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1861"></a>
Ranking of potential parents</h2>
<p>The currently implemented ranking metric is very simple: the potential parent node with the smallest rank is chosen. Additionally, nodes advertise the number of free BLE connection slots. In case where multiple nodes advertise the same RPL rank, the one with the largest number of open BLE connection slots is selected. The idea behind this is to balance the number of BLE connections per node, and with that also to balance the RPL DODAG.</p>
<h1><a class="anchor" id="autotoc_md1862"></a>
Usage</h1>
<p>To use this module, simply include <code>nimble_rpble</code> into your build. If nothing is explicitly configured, the module will use the default configuration as specified in <code><a class="el" href="nimble__rpble__params_8h.html" title="Default configuration for the nimble_netif_rpble module.">pkg/nimble/rpble/include/nimble_rpble_params.h</a></code>.</p>
<p>Once a node is configured as RPL root (e.g. using the <code>rpl root ..</code> shell command), it will automatically start to advertise itself. Non-RPL-root nodes will automatically scan for potential parent nodes and join the network as soon as they find fitting neighbors.</p>
<h2><a class="anchor" id="autotoc_md1863"></a>
Implementation status</h2>
<p>In its current state, the implementation only works for environments where a single RPL network with a single DODAG are present. The DODAG ID, instance ID, and DODAG version are currently pretty much ignored when scanning for potential parents. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nimble__rpble_8h.html">nimble_rpble.h</a></td></tr>
<tr class="memdesc:nimble__rpble_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface for the nimble_rpble module. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nimble__rpble__params_8h.html">nimble_rpble_params.h</a></td></tr>
<tr class="memdesc:nimble__rpble__params_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default configuration for the nimble_netif_rpble module. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">rpble configuration parameters  <a href="structnimble__rpble__cfg__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnimble__rpble__ctx__t.html">nimble_rpble_ctx_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">RPL DODAG information.  <a href="structnimble__rpble__ctx__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga214c1ef76f1a96dc5a38cdc4f8cdf12e" id="r_ga214c1ef76f1a96dc5a38cdc4f8cdf12e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga214c1ef76f1a96dc5a38cdc4f8cdf12e">nimble_rpble_init</a> (const <a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a> *cfg)</td></tr>
<tr class="memdesc:ga214c1ef76f1a96dc5a38cdc4f8cdf12e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the nimble_rpble module with the given parameters.  <br /></td></tr>
<tr class="separator:ga214c1ef76f1a96dc5a38cdc4f8cdf12e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab3316c8f8ba5cda852ef938837ee9f07" id="r_gab3316c8f8ba5cda852ef938837ee9f07"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab3316c8f8ba5cda852ef938837ee9f07">nimble_rpble_param_update</a> (const <a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a> *cfg)</td></tr>
<tr class="memdesc:gab3316c8f8ba5cda852ef938837ee9f07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the used timing parameters.  <br /></td></tr>
<tr class="separator:gab3316c8f8ba5cda852ef938837ee9f07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadc1f0ebd0db249bac732c75178014091" id="r_gadc1f0ebd0db249bac732c75178014091"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gadc1f0ebd0db249bac732c75178014091">nimble_rpble_eventcb</a> (<a class="el" href="group__pkg__nimble__netif.html#gab1da1302e4fc013bf5c6d65029da922b">nimble_netif_eventcb_t</a> cb)</td></tr>
<tr class="memdesc:gadc1f0ebd0db249bac732c75178014091"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register a callback that is called on BLE events.  <br /></td></tr>
<tr class="separator:gadc1f0ebd0db249bac732c75178014091"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6660af9989321cefe476ac987f84b282" id="r_ga6660af9989321cefe476ac987f84b282"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6660af9989321cefe476ac987f84b282">nimble_rpble_update</a> (const <a class="el" href="structnimble__rpble__ctx__t.html">nimble_rpble_ctx_t</a> *ctx)</td></tr>
<tr class="memdesc:ga6660af9989321cefe476ac987f84b282"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the current RPL context.  <br /></td></tr>
<tr class="separator:ga6660af9989321cefe476ac987f84b282"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="gadc1f0ebd0db249bac732c75178014091" name="gadc1f0ebd0db249bac732c75178014091"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadc1f0ebd0db249bac732c75178014091">&#9670;&#160;</a></span>nimble_rpble_eventcb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nimble_rpble_eventcb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__pkg__nimble__netif.html#gab1da1302e4fc013bf5c6d65029da922b">nimble_netif_eventcb_t</a></td>          <td class="paramname"><span class="paramname"><em>cb</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register a callback that is called on BLE events. </p>
<p>The registered callback function is a simple pass-through of nimble_netif events. The callback is executed in the context of NimBLE's host thread.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>event callback to register, set to NULL to remove </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga214c1ef76f1a96dc5a38cdc4f8cdf12e" name="ga214c1ef76f1a96dc5a38cdc4f8cdf12e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga214c1ef76f1a96dc5a38cdc4f8cdf12e">&#9670;&#160;</a></span>nimble_rpble_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nimble_rpble_init </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a> *</td>          <td class="paramname"><span class="paramname"><em>cfg</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the nimble_rpble module with the given parameters. </p>
<dl class="section note"><dt>Note</dt><dd>This function must be called only once, typically during system initialization</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>configuration parameters</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success </dd></dl>

</div>
</div>
<a id="gab3316c8f8ba5cda852ef938837ee9f07" name="gab3316c8f8ba5cda852ef938837ee9f07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab3316c8f8ba5cda852ef938837ee9f07">&#9670;&#160;</a></span>nimble_rpble_param_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nimble_rpble_param_update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a> *</td>          <td class="paramname"><span class="paramname"><em>cfg</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the used timing parameters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>configuration parameters</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success </dd></dl>

</div>
</div>
<a id="ga6660af9989321cefe476ac987f84b282" name="ga6660af9989321cefe476ac987f84b282"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6660af9989321cefe476ac987f84b282">&#9670;&#160;</a></span>nimble_rpble_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nimble_rpble_update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structnimble__rpble__ctx__t.html">nimble_rpble_ctx_t</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the current RPL context. </p>
<dl class="section note"><dt>Note</dt><dd>This function is meant to be called only by the RPL implementation</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>current DODAG state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success </dd>
<dd>
-EALREADY if the given context did not change </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->

    </div>
  </body>
</html>
