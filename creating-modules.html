<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RIOT OS: Creating modules</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<!-- <script type="text/javascript" src="jquery.js"></script> -->
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<!-- <link href="/pagefind/pagefind-ui.css" rel="stylesheet"> -->
<script src="/pagefind/pagefind-ui.js"></script>
<script>
  // Check whether the PagefindUI class is available
  if (typeof PagefindUI === 'undefined') {
    console.error('PagefindUI class is not available | Dev Build');
  } else {
    // // Remove the "searchstub" element and initialize the PagefindUI class
    // document.getElementById("#searchstub").remove();
    // Initialize the PagefindUI class with the element id "search"
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
  }
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="global.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <script>
    // Print the data within the NAVTREE variable from the navtreedata.js file
    var navtree = NAVTREE;
    console.log(navtree);
  </script>
<div class="flex flex-row gap-4 w-screen font-sans text-lg max-h-screen overscroll-contain justify-items-stretch bg-neutral-900">
  <!--Sidebar-->
  <div data-pagefind-ignore="all" class="w-1/3 max-w-md flex-auto h-screen bg-neutral-800 ring-2 ring-neutral-700 shadow-neutral-800 shadow-2xl rounded-xl p-3 ml-1 my-2 mr-3 flex flex-col justify-around">
    <div id="top" class="justify-self-center content-center items-center place-content-center">
      <img alt="Logo" src="riot-logo.svg"/>
      <div id="projectbrief">
        The friendly Operating System for the Internet of Things
      </div>
    </div>
    <div id="search" class="place-content-center" class="overflow-y-scroll max-h-64 bg-slate-400 ring-2 ring-white text-white" >
      <h1>Searchbar via Pagefind</h1>
      <!-- <div id="searchstub" class="flex items-center border border-gray-300 rounded-lg p-2 shadow-sm">
        <input type="text" placeholder="Search is only available in Production Build ..." class="flex-grow p-2 outline-none">
      </div> -->
    </div>
    <div id="navtree">
      <script>
        // The navtree variable is always a pair of two elements (key, value)
        // The key is the name we should display and the value is the link to the page
        // Generate the navtree from the navtreedata.js file and put it under the navtree div
        var navtree = NAVTREE[0][2];
        var navtreeHTML = "<h1>Navigation based on Doxygen</h1> <ul>";
        for (var i = 0; i < navtree.length; i++) {
          navtreeHTML += "<li><a href='" + navtree[i][1] + "'>" + navtree[i][0] + "</a></li>";
          if (i == 5) {
            navtreeHTML += '<li><h3 class="ring-2 ring-white"> Random Insert for Demonstration </h3></li>';
          }
        }
        navtreeHTML += "</ul>";
        document.getElementById("navtree").innerHTML = navtreeHTML;
      </script>
    </div>
    <ul>
      <li class="footer">
        Generated on Tue Sep 24 2024 11:16:26 by 
          <a href="http://www.doxygen.org/index.html">
            Doxygen
          </a> 
        1.12.0
      </li>
    </ul>
  </div>
  <!--Main Content-->
  <div class="hidden">
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('creating-modules.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Creating modules</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_2doxygen_2src_2creating-modules"></a></p>
<p>Modules in RIOT are well-defined units of code that provide a set of features to your application. This includes also drivers and to a certain extent ports for CPUs and boards (with some exceptions, see the porting guide for further information).</p>
<h1><a class="anchor" id="the-general-structure"></a>
The general structure</h1>
<p>Like <a class="el" href="creating-an-application.html">applications</a>, modules are directories containing source files and a Makefile. Additionally their API can be defined in one or more header files, residing in the include path of their super-module.</p>
<p>E.g. the <a class="el" href="group__sys__shell.html">Shell</a> module is implemented in <code>sys/shell</code> and defines its API in <code><a class="el" href="shell_8h.html" title="Shell interface definition.">sys/include/shell.h</a></code> and the <a class="el" href="group__drivers__isl29020.html">ISL29020 light sensor</a> driver is implemented in <code>drivers/isl29020</code> and defines its API in <code><a class="el" href="isl29020_8h.html" title="Device driver interface for the ISL29020 light sensor.">drivers/include/isl29020.h</a></code>.</p>
<p>A module's Makefile just needs to include <code>Makefile.base</code> in the RIOT repository:</p>
<div class="fragment"><div class="line">include $(RIOTBASE)/Makefile.base</div>
</div><!-- fragment --><p>If your module's name differs from the name of the directory it resides in you need to set the <code>MODULE</code> macro in addition.</p>
<p>When compiled a module always provides a <code>MODULE_&lt;MODULENAME&gt;</code> macro to the system. This way, other modules can check if the module is available in the current configuration or not.</p>
<p>Modules can be used by adding their name to the <code>USEMODULE</code> macro of your application's Makefile.</p>
<h3><a class="anchor" id="autotoc_md2204"></a>
Pitfalls</h3>
<p>The <code>MODULE</code> name should be unique or build breaks as modules overwrite the same output file. This might for example lead to <code>undefined reference to</code> errors in the linker which can be hard to track down.</p>
<p>This problem happened in the past for:</p>
<ul>
<li>Packages root directory (libfixmath/u8g2)</li>
<li>boards/cpu/periph and their common boards/cpu/periph</li>
</ul>
<p>Note: even if all boards and cpus implement the <code>board</code> and <code>cpu</code> modules, only one is used in an application so there is no conflict.</p>
<h1><a class="anchor" id="autotoc_md2205"></a>
Module dependencies</h1>
<p>Your module may depend on other modules to minimize code duplication. These dependencies are defined in <code>Makefile.dep</code> with the following syntax:</p>
<div class="fragment"><div class="line">ifneq (,$(filter your_module,$(USEMODULE))) <span class="comment"># if module in USEMODULE</span></div>
<div class="line">  USEMODULE += dep1                         <span class="comment"># add dependencies to USEMODULE</span></div>
<div class="line">  USEMODULE += dep2</div>
<div class="line">endif</div>
</div><!-- fragment --><p>Note, that <code>Makefile.dep</code> is processed only once so you have to take care to add the dependency block for your module <em>before</em> your dependencies pull in their dependencies.</p>
<h1><a class="anchor" id="modules-outside-of-riotbase"></a>
Modules outside of RIOTBASE</h1>
<p>Modules can be defined outside <code>RIOTBASE</code>. In addition to add it to <code>USEMODULE</code> the user needs to add the directory (or directories) containing external modules to <code>EXTERNAL_MODULE_DIRS</code>.</p>
<p>External modules can optionally define the following files:</p><ul>
<li><code>Makefile.include</code> file to set global build configuration like <code>CFLAGS</code> or add API headers include paths to the <code>USEMODULE_INCLUDES</code> variable.</li>
<li><code>Makefile.dep</code> file to set module dependencies</li>
</ul>
<p><em><b>NOTE:</b></em> The name of an external module must be unique (both in regard to other external modules, as well to native RIOT modules). Additionally, the directory containing the module must match the module name, e.g. module <code>foo</code> must be located in <code>&lt;PATH_IN_EXTERNAL_MODULE_DIRS&gt;/foo</code>.</p>
<p>An example can be found in <a href="https://github.com/RIOT-OS/RIOT/tree/master/tests/build_system/external_module_dirs"><code>tests/build_system/external_module_dirs</code></a></p>
<h1><a class="anchor" id="pseudomodules"></a>
Pseudomodules</h1>
<p>Pseudomodules are modules that are not static libraries, i.e. do not generate a <code>&lt;module name&gt;.a</code> file.</p>
<p>To create a pseudomodule just add its name to <code><a class="el" href="pseudomodules_8inc_8mk_source.html">makefiles/pseudomodules.inc.mk</a></code> with <code>PSEUDOMODULES += &lt;modulename&gt;</code> in alphabetical order.</p>
<p>A Pseudomodule may or may not have a source file associated with it. To make the distinction between them we will refer to those that don't as true-Pseudomodules.</p>
<p>The main use case for true-Pseudomodules is to provide base information for dependencies to other modules or information to the code base via the <code>MODULE_&lt;MODULENAME&gt;</code> macro.</p>
<p>Pseudomodules with source code exist under a "real" <code>MODULE</code> since they will generate a <code>&lt;pseudomodule_name&gt;.o</code> file grouped under that <code>MODULE</code>s <code>&lt;module_name&gt;.a</code> file.</p>
<p>These modules appear in RIOT under two forms:</p>
<ol type="1">
<li><p class="startli">Conditionally included source files:</p>
<div class="fragment"><div class="line">foo/</div>
<div class="line">|----foo_bar.c</div>
<div class="line">|----foo.c</div>
<div class="line">|----Makefile</div>
</div><!-- fragment --></li>
</ol>
<p>In <code>foo/Makefile</code> you add the source file to the <code>SRC</code> variable, conditioned on the Pseudomodule inclusion</p>
<div class="fragment"><div class="line">ifneq (,$(filter foo_bar,$(USEMODULE)))</div>
<div class="line">  SRC += foo_bar.c</div>
<div class="line">endif</div>
</div><!-- fragment --><p>See <code>sys/net/ble/skald</code> for an example in code.</p>
<ol type="1">
<li><p class="startli">Using the <code>SUBMODULES</code> mechanism:</p>
<div class="fragment"><div class="line">foo/</div>
<div class="line">|----spam.c</div>
<div class="line">|----ham.c</div>
<div class="line">|----eggs.c</div>
<div class="line">|----Makefile</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment"># make all code end up in &quot;foo_bar.a&quot;, this can be any name</span></div>
<div class="line">MODULE := foo_bar</div>
<div class="line"> </div>
<div class="line"><span class="comment"># ensure that &quot;foo_ham&quot; or &quot;bar_foo_ham&quot; builds &quot;foo_ham.c&quot;.</span></div>
<div class="line">BASE_MODULE := foo</div>
<div class="line"> </div>
<div class="line"><span class="comment"># list of source files that are not SUBMODULES</span></div>
<div class="line">SRC := spam.c</div>
<div class="line"> </div>
<div class="line"><span class="comment"># enable submodules by setting SUBMODULES = 1</span></div>
<div class="line">SUBMODULES = 1</div>
</div><!-- fragment --></li>
</ol>
<p>When using <code>SUBMODULES</code> in a <code>MODULE</code> all <code>SRC</code> file excluded from <code>foo/Makefile</code> will be considered <code>SUBMODULES</code>. In the example above <code>ham.c</code> and <code>eggs.c</code>. These source files will be conditionally included depending if the modules have been added, i.e. <code>USEMODULE += foo_ham foo_eggs</code> (it's the same as case 1 but handled automatically in <code>Makefile.base</code>).</p>
<p>The <code>SUBMODULES</code> mechanism is more flexible since <code>BASE_MODULE</code> allows matching the only parts of compounded module names and only match against part of that name.</p>
<p>See <code>sys/ztimer/Makefile</code> for an example in code.</p>
<p><code>SUBMODULES</code> can also be true-pseudomodules, or become one by conditionally excluding the source files by adding them to <code>SUBMODULES_NO_SRC</code>.</p>
<h1><a class="anchor" id="autotoc_md2206"></a>
Helper tools</h1>
<p>To help you start writing a module, the RIOT build system provides the <code>generate-module</code> make target. It is a wrapper around the <a href="https://pypi.org/project/riotgen/">riotgen</a> command line tool that is helpful when starting to implement a module: all required files are generated with copyright headers, doxygen groups, etc, so you can concentrate on the module implementation. The module source files are created in the <code>sys</code> directory.</p>
<p><b>Usage:</b></p>
<p>From the RIOT base directory, run: </p><div class="fragment"><div class="line">make generate-module</div>
</div><!-- fragment --><p> Then answer a few questions about the driver:</p><ul>
<li>Module name: enter a name for your module. It will be used as both the name of the module directory under sys, where the source files are created, and the build system module (used with <code>USEMODULE</code>).</li>
<li>Module doxygen name: Enter the name of module, as displayed in the Doxygen documentation.</li>
<li>Brief doxygen description: Describe in one line what is this module about.</li>
</ul>
<p>Other global information (author name, email, organization) should be retrieved automatically from your git configuration.</p>
<p>Once completed, the module files are located in <code>sys/&lt;module name&gt;/&lt;module name&gt;.c</code> and <code>sys/include/&lt;module name&gt;.h</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

    </div>
  </body>
</html>
