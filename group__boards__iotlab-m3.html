<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RIOT OS: IoT-LAB M3 open node</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<!-- <script type="text/javascript" src="jquery.js"></script> -->
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<!-- <link href="/pagefind/pagefind-ui.css" rel="stylesheet"> -->
<script src="/pagefind/pagefind-ui.js"></script>
<script>
  // Check whether the PagefindUI class is available
  if (typeof PagefindUI === 'undefined') {
    console.error('PagefindUI class is not available | Dev Build');
  } else {
    // // Remove the "searchstub" element and initialize the PagefindUI class
    // document.getElementById("#searchstub").remove();
    // Initialize the PagefindUI class with the element id "search"
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
  }
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="global.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <script>
    // Print the data within the NAVTREE variable from the navtreedata.js file
    var navtree = NAVTREE;
    console.log(navtree);
  </script>
<div class="flex flex-row gap-4 w-screen font-sans text-lg max-h-screen overscroll-contain justify-items-stretch bg-neutral-900">
  <!--Sidebar-->
  <div data-pagefind-ignore="all" class="w-1/3 max-w-md flex-auto h-screen bg-neutral-800 ring-2 ring-neutral-700 shadow-neutral-800 shadow-2xl rounded-xl p-3 ml-1 my-2 mr-3 flex flex-col justify-around">
    <div id="top" class="justify-self-center content-center items-center place-content-center">
      <img alt="Logo" src="riot-logo.svg"/>
      <div id="projectbrief">
        The friendly Operating System for the Internet of Things
      </div>
    </div>
    <div id="search" class="place-content-center" class="overflow-y-scroll max-h-64 bg-slate-400 ring-2 ring-white text-white" >
      <h1>Searchbar via Pagefind</h1>
      <!-- <div id="searchstub" class="flex items-center border border-gray-300 rounded-lg p-2 shadow-sm">
        <input type="text" placeholder="Search is only available in Production Build ..." class="flex-grow p-2 outline-none">
      </div> -->
    </div>
    <div id="navtree">
      <script>
        // The navtree variable is always a pair of two elements (key, value)
        // The key is the name we should display and the value is the link to the page
        // Generate the navtree from the navtreedata.js file and put it under the navtree div
        var navtree = NAVTREE[0][2];
        var navtreeHTML = "<h1>Navigation based on Doxygen</h1> <ul>";
        for (var i = 0; i < navtree.length; i++) {
          navtreeHTML += "<li><a href='" + navtree[i][1] + "'>" + navtree[i][0] + "</a></li>";
          if (i == 5) {
            navtreeHTML += '<li><h3 class="ring-2 ring-white"> Random Insert for Demonstration </h3></li>';
          }
        }
        navtreeHTML += "</ul>";
        document.getElementById("navtree").innerHTML = navtreeHTML;
      </script>
    </div>
    <ul>
      <li class="footer">
        Generated on Tue Sep 24 2024 11:16:26 by 
          <a href="http://www.doxygen.org/index.html">
            Doxygen
          </a> 
        1.12.0
      </li>
    </ul>
  </div>
  <!--Main Content-->
  <div class="hidden">
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__boards__iotlab-m3.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle"><div class="title">IoT-LAB M3 open node<div class="ingroups"><a class="el" href="group__boards.html">Boards</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Support for the iotlab-m3 board  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Support for the iotlab-m3 board </p>
<h2><a class="anchor" id="autotoc_md464"></a>
Components</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">MCU   </th><th class="markdownTableHeadLeft"><a href="http://www.st.com/web/catalog/mmc/FM141/SC1169/SS1031/LN1565/PF164485">ST2M32F103REY</a> – 32-bits, 64KiB RAM    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">sensors   </td><td class="markdownTableBodyLeft">Light (<a href="https://www.renesas.com/kr/en/products/sensors/ambient-light-sensors/light-to-digital-sensors/device/ISL29020.html">ISL29020</a>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">Pressure (<a href="http://www.st.com/web/catalog/sense_power/FM89/SC1316/PF251601">LPS331AP</a>)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">Tri-axis accelerometer/magnetometer (<a href="http://www.st.com/web/catalog/sense_power/FM89/SC1449/PF251940">LSM303DLHC</a>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">Tri-axis gyrometer (<a href="http://www.st.com/web/catalog/sense_power/FM89/SC1288/PF250373">L3G4200D</a>)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">external memory   </td><td class="markdownTableBodyLeft">128 Mbits external Nor flash (<a href="https://www.micron.com/-/media/client/global/documents/products/data-sheet/nor-flash/serial-nor/n25q/n25q_128mb_3v_65nm.pdf">N25Q128A13E1240F</a>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">power   </td><td class="markdownTableBodyLeft">3,7V LiPo battery – 650 mAh (<a href="http://www.gmbattery.com/Datasheet/LIPO/LIPO-063040.pdf">063040</a>)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">radio chipset   </td><td class="markdownTableBodyLeft"><a href="http://www.atmel.com/images/doc8111.pdf">AT86RF231</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">a IEEE802.15.4-compliant radio at 2.4 GHz   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md465"></a>
Board HW overview</h2>
<p><img src="https://www.iot-lab.info/wp-content/uploads/2013/10/m3opennode.png" alt="IoT-LAB M3 Layout" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md466"></a>
Board Architecture</h3>
<p><img src="https://github.com/iot-lab/iot-lab/wiki/Images/archiopenm3.png" alt="IoT-LAB M3 Architecture" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md467"></a>
<a href="http://github.com/iot-lab/iot-lab/wiki/Docs/openm3-schematics.pdf">Board schematics</a></h3>
<p>, wiring, pinouts, etc...</p>
<h2><a class="anchor" id="autotoc_md468"></a>
Implementation Status</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Device   </th><th class="markdownTableHeadLeft">ID   </th><th class="markdownTableHeadLeft">Supported   </th><th class="markdownTableHeadLeft">Comments    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">MCU   </td><td class="markdownTableBodyLeft"><a href="http://www.st.com/st-web-ui/static/active/en/resource/technical/document/reference_manual/CD00171190.pdf">STM32F103REY</a>   </td><td class="markdownTableBodyLeft">partly   </td><td class="markdownTableBodyLeft">Energy saving modes not fully utilized    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Low-level driver   </td><td class="markdownTableBodyLeft">GPIO   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">PWM   </td><td class="markdownTableBodyLeft">no   </td><td class="markdownTableBodyLeft">periph config missing    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">UART   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">I2C   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">SPI   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">USB   </td><td class="markdownTableBodyLeft">no   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">RTT   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft"><a class="el" href="structTimer.html" title="struct to get time references within mqtt paho">Timer</a>   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Radio Chip   </td><td class="markdownTableBodyLeft">AT86RF231   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Accelerometer   </td><td class="markdownTableBodyLeft">LSM303DLHC   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Magnetometer   </td><td class="markdownTableBodyLeft">LSM303DLHC   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Gyroscope   </td><td class="markdownTableBodyLeft">L3G4200D   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Pressure Sensor   </td><td class="markdownTableBodyLeft">LPS331AP   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Light Sensor   </td><td class="markdownTableBodyLeft">ISL29020   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SPI Flash   </td><td class="markdownTableBodyLeft">N25Q128   </td><td class="markdownTableBodyLeft">yes   </td><td class="markdownTableBodyLeft"></td></tr>
</table>
<h2><a class="anchor" id="autotoc_md469"></a>
Toolchains</h2>
<p>See <a href="https://github.com/RIOT-OS/RIOT/wiki/Family:-ARM">ARM Family</a></p>
<p>Working: <a href="https://github.com/RIOT-OS/RIOT/wiki/Family:-ARM#gcc-
arm-embedded-toolchain">gcc-arm-embedded</a> <a href="https://github.com/RIOT-OS/RIOT/wiki/Family:-ARM#linaro-
toolchain">gcc-linaro</a></p>
<h3><a class="anchor" id="autotoc_md470"></a>
Programming and Debugging</h3>
<p>In order to program (flash) and debug the node you need <a href="http://openocd.sourceforge.net/">OpenOCD</a> and an ARM version of gdb (<code>arm-none- eabi-gdb</code>), which provided by most toolchains. Most Linux distributions provide also a package for OpenOCD. The required configuration files are provided by RIOT. When starting the debugger with <code>make debug BOARD=iotlab-m3</code> GDB connects to openocd, loads the elf-file and puts the MCU into halt state. Before setting breakpoints it is sometimes needed to use the following workflow </p><div class="fragment"><div class="line">bash</div>
<div class="line">monitor reset run</div>
<div class="line">monitor reset halt</div>
<div class="line">b &lt;breakpoint&gt;</div>
<div class="line">c</div>
</div><!-- fragment --><p> For best debugging experience also change the <code>-Os</code> flag in <code>Makefile.include</code>'s <code>CFLAGS</code> variable to <code>-O0</code>.</p>
<h2><a class="anchor" id="autotoc_md471"></a>
Details</h2>
<p>The M3 Open Node can reset, debug and program the STM32 on JTAG through the FTDI2322H connected to the USB. This component allows also a UART link to the STM32. The Open Node connector gives access to 3 STM32/GPIO and the STM32/I2C. Two power lines are accessible on this connector: a + 5.0 volts for the board power supply a 3.3 volts for the consumption monitoring of the STM32, the RF component and the sensors</p>
<p>The M3 Open Node can be used standalone without a gateway connected to the M3 Open node connector. The powering of the board is then assumed by a battery or by the USB connector The choice of the power input is done electronically (power management).</p>
<p><img src="https://www.iot-lab.info/wp-
content/uploads/2013/10/archiopenm3.png" alt="IoT-LAB M3 architecture" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md472"></a>
Debugging</h2>
<p>For debugging you need to open a terminal. Here you simply have to call <code>make debug</code> - assuming that the current directory is your application directory. It establishes an openocd connection to the device and starts gdb connected to the openocd instance. For example, it should look something like this </p><div class="fragment"><div class="line">[user@host RIOT]$ cd examples/<span class="keywordflow">default</span>/</div>
<div class="line">[user@host <span class="keywordflow">default</span>]$ BOARD=iotlab-m3 make</div>
<div class="line">Building application <span class="keywordflow">default</span> <span class="keywordflow">for</span> iotlab-m3 w/ MCU stm32f1.</div>
<div class="line">...</div>
<div class="line">[user@hostdefault]$ BOARD=iotlab-m3 make debug</div>
<div class="line">RIOT/boards/hikob-common/dist/debug.sh RIOT/boards/iotlab-m3/dist/gdb.conf</div>
<div class="line">RIOT/examples/<span class="keywordflow">default</span>/bin/iotlab-m3/<span class="keywordflow">default</span>.elf</div>
<div class="line">Open On-Chip Debugger 0.8.0 (2014-07-27-20:18)</div>
<div class="line">Licensed under GNU GPL v2</div>
<div class="line">For bug reports, read</div>
<div class="line"> http:<span class="comment">//openocd.sourceforge.net/doc/doxygen/bugs.html</span></div>
<div class="line">GNU gdb (GNU Tools for ARM Embedded Processors) 7.4.1.20140401-cvs</div>
<div class="line">Copyright (C) 2012 Free Software Foundation, Inc.</div>
<div class="line">License GPLv3+: GNU GPL version 3 or later &lt;http:<span class="comment">//gnu.org/licenses/gpl.html&gt;</span></div>
<div class="line">This is <a class="code hl_function" href="group__oneway__malloc.html#gafbedc913aa4651b3c3b4b3aecd9b4711">free</a> software: you are <a class="code hl_function" href="group__oneway__malloc.html#gafbedc913aa4651b3c3b4b3aecd9b4711">free</a> to change and redistribute it.</div>
<div class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="stringliteral">&quot;show copying&quot;</span></div>
<div class="line">and <span class="stringliteral">&quot;show warranty&quot;</span> for details.</div>
<div class="line">This GDB was configured as <span class="stringliteral">&quot;--host=x86_64-apple-darwin10 --target=arm-none-</span></div>
<div class="line"><span class="stringliteral">eabi&quot;</span>.</div>
<div class="line">For bug reporting instructions, please see:</div>
<div class="line">&lt;http:<span class="comment">//www.gnu.org/software/gdb/bugs/&gt;...</span></div>
<div class="line">Reading symbols from RIOT/examples/default/bin/iotlab-m3/default.elf...done.</div>
<div class="line">idle_thread (arg=&lt;optimized out&gt;) at RIOT/core/<a class="code hl_function" href="group__core__init__config.html#ga0dbe43a64cbf994bf9189e7767f93342">kernel_init</a>.c:67</div>
<div class="line">67               lpm_set(LPM_IDLE);</div>
<div class="line">JTAG tap: stm32f1x.cpu tap/device found: 0x3ba00477 (mfg: 0x23b, part:</div>
<div class="line">0xba00, ver: 0x3)</div>
<div class="line">JTAG tap: stm32f1x.bs tap/device found: 0x06414041 (mfg: 0x020, part: 0x6414,</div>
<div class="line">ver: 0x0)</div>
<div class="line">target state: halted</div>
<div class="line">target halted due to debug-request, current mode: <a class="code hl_struct" href="structThread.html">Thread</a></div>
<div class="line">xPSR: 0x01000000 pc: 0x0800027c msp: 0x20002200</div>
<div class="line">Loading section .text, size 0x6df4 lma 0x8000000</div>
<div class="line">Loading section .ARM.exidx, size 0x8 lma 0x8006df4</div>
<div class="line">Loading section .relocate, size 0x120 lma 0x8006dfc</div>
<div class="line">Start address 0x8000000, load size 28444</div>
<div class="line">Transfer rate: 11 KB/sec, 7111 bytes/write.</div>
<div class="line">(gdb) c</div>
<div class="line">Continuing.</div>
<div class="ttc" id="agroup__core__init__config_html_ga0dbe43a64cbf994bf9189e7767f93342"><div class="ttname"><a href="group__core__init__config.html#ga0dbe43a64cbf994bf9189e7767f93342">kernel_init</a></div><div class="ttdeci">void kernel_init(void)</div><div class="ttdoc">Initializes scheduler and creates main and idle task.</div></div>
<div class="ttc" id="agroup__oneway__malloc_html_gafbedc913aa4651b3c3b4b3aecd9b4711"><div class="ttname"><a href="group__oneway__malloc.html#gafbedc913aa4651b3c3b4b3aecd9b4711">free</a></div><div class="ttdeci">void free(void *ptr)</div><div class="ttdoc">This is a no-op.</div></div>
<div class="ttc" id="astructThread_html"><div class="ttname"><a href="structThread.html">Thread</a></div><div class="ttdoc">Thread struct within mqtt paho.</div><div class="ttdef"><b>Definition</b> <a href="paho__mqtt_8h_source.html#l00176">paho_mqtt.h:176</a></div></div>
</div><!-- fragment --><p>The node will reboot and you can continue to use <code>gdb</code> like you're used to. In some cases it seems necessary to prepend a <code>monitor reset run</code> before executing continue. In general you can use openocd commands prepended by <code>monitor</code>. In the case the node crashes it can be reset with the following sequence </p><div class="fragment"><div class="line">Bash</div>
<div class="line">(gdb) monitor reset halt</div>
<div class="line">(gdb) monitor reset run</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md473"></a>
Troubleshooting</h2>
<p>For terminal output on macOS (<code>make term</code>) you need to install a driver: <a href="http://www.ftdichip.com/Drivers/VCP.htm">http://www.ftdichip.com/Drivers/VCP.htm</a> <a href="http://www.ftdichip.com/Drivers/VCP.htm">http://www.ftdichip.com/Drivers/VCP.htm</a> </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="iotlab-m3_2include_2board_8h.html">board.h</a></td></tr>
<tr class="memdesc:iotlab-m3_2include_2board_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Board specific definitions for the iotlab-m3 board. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="boards_2iotlab-m3_2include_2periph__conf_8h.html">periph_conf.h</a></td></tr>
<tr class="memdesc:boards_2iotlab-m3_2include_2periph__conf_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Peripheral MCU configuration for the iotlab-m3 board. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->

    </div>
  </body>
</html>
