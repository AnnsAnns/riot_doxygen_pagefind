<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RIOT OS: Blackpill and Bluepill common code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<!-- <script type="text/javascript" src="jquery.js"></script> -->
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<!-- <link href="/pagefind/pagefind-ui.css" rel="stylesheet"> -->
<script src="/pagefind/pagefind-ui.js"></script>
<script>
  // Check whether the PagefindUI class is available
  if (typeof PagefindUI === 'undefined') {
    console.error('PagefindUI class is not available | Dev Build');
  } else {
    // // Remove the "searchstub" element and initialize the PagefindUI class
    // document.getElementById("#searchstub").remove();
    // Initialize the PagefindUI class with the element id "search"
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
  }
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="global.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <script>
    // Print the data within the NAVTREE variable from the navtreedata.js file
    var navtree = NAVTREE;
    console.log(navtree);
  </script>
<div class="flex flex-row gap-4 w-screen font-sans text-lg max-h-screen overscroll-contain justify-items-stretch bg-neutral-900">
  <!--Sidebar-->
  <div data-pagefind-ignore="all" class="w-1/3 max-w-md flex-auto h-screen bg-neutral-800 ring-2 ring-neutral-700 shadow-neutral-800 shadow-2xl rounded-xl p-3 ml-1 my-2 mr-3 flex flex-col justify-around">
    <div id="top" class="justify-self-center content-center items-center place-content-center">
      <img alt="Logo" src="riot-logo.svg"/>
      <div id="projectbrief">
        The friendly Operating System for the Internet of Things
      </div>
    </div>
    <div id="search" class="place-content-center" class="overflow-y-scroll max-h-64 bg-slate-400 ring-2 ring-white text-white" >
      <h1>Searchbar via Pagefind</h1>
      <!-- <div id="searchstub" class="flex items-center border border-gray-300 rounded-lg p-2 shadow-sm">
        <input type="text" placeholder="Search is only available in Production Build ..." class="flex-grow p-2 outline-none">
      </div> -->
    </div>
    <div id="navtree">
      <script>
        // The navtree variable is always a pair of two elements (key, value)
        // The key is the name we should display and the value is the link to the page
        // Generate the navtree from the navtreedata.js file and put it under the navtree div
        var navtree = NAVTREE[0][2];
        var navtreeHTML = "<h1>Navigation based on Doxygen</h1> <ul>";
        for (var i = 0; i < navtree.length; i++) {
          navtreeHTML += "<li><a href='" + navtree[i][1] + "'>" + navtree[i][0] + "</a></li>";
          if (i == 5) {
            navtreeHTML += '<li><h3 class="ring-2 ring-white"> Random Insert for Demonstration </h3></li>';
          }
        }
        navtreeHTML += "</ul>";
        document.getElementById("navtree").innerHTML = navtreeHTML;
      </script>
    </div>
    <ul>
      <li class="footer">
        Generated on Tue Sep 24 2024 11:16:26 by 
          <a href="http://www.doxygen.org/index.html">
            Doxygen
          </a> 
        1.12.0
      </li>
    </ul>
  </div>
  <!--Main Content-->
  <div class="hidden">
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__boards__common__blxxxpill.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle"><div class="title">Blackpill and Bluepill common code<div class="ingroups"><a class="el" href="group__boards.html">Boards</a> &raquo; <a class="el" href="group__boards__common.html">Common Board Groups</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Support for cheap stm32f103c8 based boards such as bluepill and blackpill.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Support for cheap stm32f103c8 based boards such as bluepill and blackpill. </p>
<h2><a class="anchor" id="autotoc_md295"></a>
Overview</h2>
<p>The bluepill and the blackpill are STM32F103 based board which can be bought for around 2€ on sides like AliExpress, eBay and others. Although the STM32F130C8 MCU nominally has 64 KiB flash, most <a href="https://web.archive.org/web/20190428082446/http://wiki.stm32duino.com/index.php?title=Blue_Pill#128_KB_flash_on_C8_version">actually have 128 KiB flash</a>.</p>
<p>There are also versions that only report to have 32 KiB, but actually have 64 KiB.</p>
<h2><a class="anchor" id="autotoc_md296"></a>
Pinout</h2>
<div class="image">
<object type="image/svg+xml" data="pinout-bluepill.svg" style="pointer-events: none;"></object>
<div class="caption">
pinout</div></div>
    <h2><a class="anchor" id="autotoc_md297"></a>
MCU</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">MCU   </th><th class="markdownTableHeadLeft">STM32F103C8 / STM32F103CB    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Family   </td><td class="markdownTableBodyLeft">ARM Cortex-M3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Vendor   </td><td class="markdownTableBodyLeft">STMicroelectronics    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RAM   </td><td class="markdownTableBodyLeft">20 KiB    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Flash   </td><td class="markdownTableBodyLeft">32 KiB / 64 KiB / 128 KiB    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Frequency   </td><td class="markdownTableBodyLeft">up to 72 MHz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="structTimer.html" title="struct to get time references within mqtt paho">Timer</a>   </td><td class="markdownTableBodyLeft">3x 16-Bit    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ADC   </td><td class="markdownTableBodyLeft">2x 12-bit, 10 channels    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">UART   </td><td class="markdownTableBodyLeft">3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SPI   </td><td class="markdownTableBodyLeft">2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">I2C   </td><td class="markdownTableBodyLeft">2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CAN   </td><td class="markdownTableBodyLeft">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Vcc   </td><td class="markdownTableBodyLeft">2.0 to 3.6 V    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Datasheet   </td><td class="markdownTableBodyLeft"><a href="http://www.st.com/content/ccc/resource/technical/document/datasheet/33/d4/6f/1d/df/0b/4c/6d/CD00161566.pdf/files/CD00161566.pdf/jcr:content/translations/en.CD00161566.pdf">Datasheet</a>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md298"></a>
Implementation Status</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">ID   </th><th class="markdownTableHeadLeft">Supported    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">GPIO   </td><td class="markdownTableBodyLeft">yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PWM   </td><td class="markdownTableBodyLeft">yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">UART   </td><td class="markdownTableBodyLeft">yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ADC   </td><td class="markdownTableBodyLeft">yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">I2C   </td><td class="markdownTableBodyLeft">yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SPI   </td><td class="markdownTableBodyLeft">yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">USB   </td><td class="markdownTableBodyLeft">no    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="structTimer.html" title="struct to get time references within mqtt paho">Timer</a>   </td><td class="markdownTableBodyLeft">yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CAN   </td><td class="markdownTableBodyLeft">no   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md299"></a>
Flashing</h2>
<p>To program and debug the board you need a SWD capable debugger. The easiest way is using <a href="https://github.com/RIOT-OS/RIOT/wiki/OpenOCD">OpenOCD</a>. By default RIOT uses the hardware reset signal and connects to the chip under reset for flashing. This is required to reliably connect to the device even when the MCU is in a low power mode. Therefore not only SWDIO and SWCLK, but also the RST pin of your debugger need to be connected to the board. Once the device is connected to the debugger and OpenOCD is installed, you can flash the device with: </p><pre class="fragment">$ make BOARD=bluepill-stm32f103c8 flash
</pre><p>Or for the blackpill with: </p><pre class="fragment">$ make BOARD=blackpill-stm32f103c8 flash
</pre><h3><a class="anchor" id="autotoc_md300"></a>
Additional Flash</h3>
<p>Typically, the STM32F103C8 does actually have 128 KiB flash. To make use of this, just flash with </p><pre class="fragment">$ make BOARD=bluepill-stm32f103cb flash
</pre><p>Or for the blackpill with: </p><pre class="fragment">$ make BOARD=blackpill-stm32f103cb flash
</pre><p>This sets the <code>CPU_MODEL</code> make variable to <code>stm32f103cb</code>, the default value is <code>stm32f103c8</code>. These two CPU models basically only have one major difference, the former has 128 KiB flash while the latter has 64 KiB.</p>
<p>In order to flash the *cb variant onto *c8 hardware requires OpenOCD in version 0.11 or later.</p>
<h2><a class="anchor" id="autotoc_md301"></a>
Connecting via Serial</h2>
<p>The default UART port used is UART1, which uses pins A9 (TX) and A10 (RX). To use it, configure your UART to operate at a symbol rate of 115200 baud, 1 stop bit and no parity (8N1).</p>
<h2><a class="anchor" id="autotoc_md302"></a>
Using PWM</h2>
<p>PWM is available at pins A8 to A11.</p>
<h2><a class="anchor" id="autotoc_md303"></a>
Known Issues</h2>
<h3><a class="anchor" id="autotoc_md304"></a>
USB connector</h3>
<p>The Micro-USB port is sometimes not soldered properly. Also, it is usually equipped with an incorrect resistor. <a href="https://web.archive.org/web/20190428082446/http://wiki.stm32duino.com/index.php?title=Blue_Pill#Hardware_installation">This can be fixed multiple ways</a>.</p>
<h3><a class="anchor" id="autotoc_md305"></a>
Flashing fails</h3>
<p>Please check whether the debugger is properly connected, including the hardware reset signal pin.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Pin on Debugger   </th><th class="markdownTableHeadLeft">Pin on Blue Pill    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SWDIO   </td><td class="markdownTableBodyLeft">DIO    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SWCLK   </td><td class="markdownTableBodyLeft">DCLK    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">NRST   </td><td class="markdownTableBodyLeft">R    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">GND   </td><td class="markdownTableBodyLeft">GND    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">VDD (3.3V) (*)   </td><td class="markdownTableBodyLeft">3.3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Target VCC (**)   </td><td class="markdownTableBodyLeft">3.3   </td></tr>
</table>
<ul>
<li>(*) Most debuggers have a 3.3V supply voltage to power the board. You can alternatively power the board using the TTL-Adapter or via Micro-USB.</li>
<li>(**) Some debuggers monitor the voltage of the target MCU. Their target VCC pin needs to be connected to one of the 3.3V pins of the boards.</li>
</ul>
<p>Most very cheap SWD debuggers (especially those imported for about 2€ from far east) do not have a Target VCC pin; they will still work just fine. On these cheap debuggers the pin to send the reset signal to the board is often either not present or defunct. You can work around this by pressing the reset button when OpenOCD wants to connect to the Blue Pill. Hit the reset button again after flashing in order to boot the newly flashed image.</p>
<h2><a class="anchor" id="autotoc_md306"></a>
Where to buy</h2>
<p>The board is sold under different names. On some sites it is called <code>bluepill</code> or <code>blue pill</code>. On others you might find it by searching for <code>stm32f103c8</code> or <code>stm32f103c8t6</code>.</p>
<p>Try <a href="https://www.ebay.com/sch/i.html?_nkw=stm32f103c8">eBay</a> or <a href="https://www.aliexpress.com/wholesale?SearchText=STM32F103C8T6">AliExpress</a>.</p>
<h2><a class="anchor" id="autotoc_md307"></a>
Further reading</h2>
<ul>
<li><a href="https://web.archive.org/web/20190428082446/http://wiki.stm32duino.com/index.php?title=Blue_Pill">Blue Pill Wiki</a></li>
<li><a href="https://web.archive.org/web/20190428082446/http://wiki.stm32duino.com/index.php?title=Maple_Mini#Clones">Maple Mini Wiki</a></li>
<li><a href="http://www.st.com/content/st_com/en/products/microcontrollers/stm32-32-bit-arm-cortex-mcus/stm32-mainstream-mcus/stm32f1-series/stm32f103/stm32f103c8.html">STM32F103C8 Datasheet</a> </li>
</ul>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blxxxpill_2include_2board__common_8h.html">board_common.h</a></td></tr>
<tr class="memdesc:blxxxpill_2include_2board__common_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Peripheral MCU configuration for the bluepill/blackpill board. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="common_2blxxxpill_2include_2gpio__params_8h.html">gpio_params.h</a></td></tr>
<tr class="memdesc:common_2blxxxpill_2include_2gpio__params_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Board specific configuration of direct mapped GPIOs. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="boards_2common_2blxxxpill_2include_2periph__conf_8h.html">periph_conf.h</a></td></tr>
<tr class="memdesc:boards_2common_2blxxxpill_2include_2periph__conf_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Peripheral MCU configuration for the bluepill/blackpill boards. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->

    </div>
  </body>
</html>
